{% extends "base.html" %}
{% block title %}就诊记录 - 诊疗通{% endblock %}

{% block content %}
<div class="card">
    <div class="page-title">
        <div>
            <h2>我的就诊记录</h2>
            <div class="subtitle">查看已就诊的病历摘要与支付状态。</div>
        </div>
        <a class="btn btn--ghost" href="{{ url_for('cashier.patient_payments') }}">查看费用</a>
    </div>
</div>

<div class="card">
    <div class="table-wrap">
        <table class="table">
            <thead>
            <tr>
                <th>挂号时间</th>
                <th>预约日/时间段</th>
                <th>科室/医生</th>
                <th>就诊状态</th>
                <th>支付</th>
                <th>病历摘要</th>
            </tr>
            </thead>
            <tbody>
            {% for r in rows %}
                <tr>
                    <td>{{ r.reg_time }}</td>
                    <td>{{ r.visit_date|default('—', true) }} {{ r.time_slot|default('—', true) }}</td>
                    <td>{{ r.dept_name }} / {{ r.doctor_name }}</td>
                    <td>
                        {% if r.visit_status == '已就诊' %}
                            <span class="badge badge--success">已就诊</span>
                        {% elif r.visit_status == '就诊中' %}
                            <span class="badge badge--info">就诊中</span>
                        {% elif r.visit_status == '未就诊' %}
                            <span class="badge badge--warning">未就诊</span>
                        {% else %}
                            <span class="badge badge--muted">已取消</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if r.fee_status == '已支付' %}
                            <span class="badge badge--success">已支付</span>
                        {% else %}
                            <span class="badge badge--warning">未支付</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if r.diagnosis %}
                            <div class="mono" style="font-weight:700;">诊断：{{ r.diagnosis }}</div>
                            <div class="muted">主诉：{{ r.main_complaint|default('—', true) }}</div>
                            <div class="muted">时间：{{ r.create_time }}</div>
                        {% else %}
                            <span class="muted">暂无病历</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            {% if not rows %}
                <tr><td colspan="6" class="muted">暂无就诊记录</td></tr>
            {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
