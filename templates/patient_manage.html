<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>患者信息管理</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background:#f5f7fa; margin:0; padding:20px; }
        .layout { max-width: 1200px; margin:0 auto; }
        .card { background:#fff; border-radius:10px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,0.06); margin-bottom:16px; }
        h1 { margin:0 0 10px; }
        label { display:block; font-weight:600; color:#444; margin:8px 0 4px; }
        input, select { width:100%; padding:8px 10px; border:1px solid #dcdfe6; border-radius:6px; box-sizing:border-box; }
        .flex { display:flex; gap:12px; }
        .btn { padding:10px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
        .btn-primary { background:#409eff; color:#fff; }
        .btn-plain { background:#ebeef5; color:#606266; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        th, td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
        th { background:#f2f6fc; }
        .flash { padding:10px; border-radius:6px; margin-bottom:8px; }
        .flash-success { background:#f0f9eb; color:#67c23a; }
        .flash-error { background:#fef0f0; color:#f56c6c; }
        .flash-info { background:#ecf5ff; color:#409eff; }
        a { color:#409eff; text-decoration:none; }
    </style>
</head>
<body>
<div class="layout">
    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h1>患者信息管理</h1>
            <p style="color:#666;">P1 患者档案创建 / P2 信息查询 / P3 信息维护 与就诊记录查看</p>
        </div>
        <div>
            <a href="/registration/manage" style="margin-right:12px;">挂号管理</a>
            <a href="/doctor_dashboard" style="margin-right:12px;">医生端</a>
            <a href="/patient_home" style="margin-right:12px;">患者端</a>
            <a href="/cashier" style="margin-right:12px;">收银台</a>
            <a href="/logout" style="color:#f56c6c;">退出</a>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for cat, msg in messages %}
                <div class="flash flash-{{cat}}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="card">
        <form method="GET" action="/patients" style="display:flex; gap:10px; align-items:center;">
            <input name="q" placeholder="按姓名 / 病历号搜索" value="{{ keyword }}">
            <button class="btn btn-primary" type="submit">搜索</button>
            <a class="btn btn-plain" href="/patients">重置</a>
        </form>
    </div>

    <div class="flex">
        <div class="card" style="flex:1;">
            <h3>P1. 新建患者档案</h3>
        <form method="POST" action="/patients/create">
            <label>姓名</label><input name="name" required>
            <label>性别</label>
            <select name="gender">
                <option value="男">男</option>
                <option value="女">女</option>
                </select>
                <label>年龄</label><input type="number" name="age" min="0" required>
                <label>手机号</label><input name="phone" required>
                <label>过敏史</label><input name="allergy" placeholder="可选">
                <label>病历号（留空自动生成）</label><input name="medical_record_no" placeholder="如留空将自动生成">
                <p style="color:#999;font-size:12px;">初始登录密码默认为 123456。</p>
                <button class="btn btn-primary" type="submit">创建档案</button>
            </form>
        </div>

        <div class="card" style="flex:2;">
            <h3>P2/P3. 患者列表（可编辑）</h3>
            <table>
                <thead>
                <tr><th>ID</th><th>姓名</th><th>性别</th><th>年龄</th><th>手机号</th><th>过敏史</th><th>病历号</th><th>操作</th></tr>
                </thead>
                <tbody>
                {% for p in patients %}
                    <tr>
                        <form method="POST" action="/patients/update">
                            <td>{{ p.patient_id }}<input type="hidden" name="patient_id" value="{{ p.patient_id }}"></td>
                            <td><input name="name" value="{{ p.name }}"></td>
                            <td>
                                <select name="gender">
                                    <option value="男" {% if p.gender=='男' %}selected{% endif %}>男</option>
                                    <option value="女" {% if p.gender=='女' %}selected{% endif %}>女</option>
                                </select>
                            </td>
                            <td><input type="number" name="age" value="{{ p.age }}"></td>
                            <td><input name="phone" value="{{ p.phone }}"></td>
                            <td><input name="allergy" value="{{ p.allergy }}"></td>
                            <td><input name="medical_record_no" value="{{ p.medical_record_no }}"></td>
                            <td style="white-space:nowrap;">
                                <button class="btn btn-primary" type="submit" style="padding:6px 10px;">保存</button>
                                <a class="btn btn-plain" style="padding:6px 10px;" href="/patients/{{ p.patient_id }}">记录</a>
                            </td>
                        </form>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>
