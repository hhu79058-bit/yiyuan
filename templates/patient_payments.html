{% extends "base.html" %}
{% block title %}我的收银台 - 诊疗通{% endblock %}

{% block content %}
    <div class="card">
        <div class="page-title">
            <div>
                <h2>我的收银台</h2>
                <div class="subtitle">查看费用明细并完成自助支付</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <a class="btn btn--ghost btn--sm" href="{{ url_for('registration.patient_home') }}">返回首页</a>
                <a class="btn btn--ghost btn--sm" href="{{ url_for('patients.patient_profile') }}">我的档案</a>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="table-wrap">
            <table class="table">
                <thead>
                <tr>
                    <th>时间</th>
                    <th>医生</th>
                    <th>预约日/班次</th>
                    <th>挂号费</th>
                    <th>检查费</th>
                    <th>药费</th>
                    <th>合计</th>
                    <th>支付状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {% for r in rows %}
                    <tr>
                        <td>{{ r.reg_time }}</td>
                        <td>{{ r.doctor_name }}</td>
                        <td>{{ r.visit_date|default('—', true) }} {{ r.shift|default('—', true) }}</td>
                        <td>￥{{ '%.2f' % r.reg_fee }}</td>
                        <td>￥{{ '%.2f' % r.check_fee }}</td>
                        <td>￥{{ '%.2f' % r.med_fee }}</td>
                        <td style="font-weight:900;">￥{{ '%.2f' % r.total_fee }}</td>
                        <td>
                            {% if r.fee_status == '已支付' %}
                                <span class="badge badge--success">已支付</span>
                            {% else %}
                                <span class="badge badge--warning">未支付</span>
                            {% endif %}
                        </td>
                        <td style="white-space:nowrap;">
                            {% if r.fee_status != '已支付' %}
                                <form method="POST" action="{{ url_for('cashier.patient_pay', reg_id=r.reg_id) }}" style="margin:0;">
                                    <button class="btn btn--primary btn--sm" type="submit" onclick="return confirm('确认支付该笔费用？');">立即支付</button>
                                </form>
                            {% else %}
                                <span class="muted">—</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                {% if not rows %}
                    <tr><td colspan="9" class="muted">暂无待支付记录</td></tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
