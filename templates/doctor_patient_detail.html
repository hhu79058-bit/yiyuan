{% extends "base.html" %}
{% block title %}患者快览 - 诊疗通{% endblock %}

{% block content %}
    <div class="card">
        <div class="page-title">
            <div>
                <h2>患者快览</h2>
                {% if patient %}
                    <div class="subtitle">
                        {{ patient.name }} ｜ {{ patient.gender }} ｜ {{ patient.age }}岁 ｜ 病历号：<span class="mono">{{ patient.medical_record_no|default('—', true) }}</span>
                    </div>
                    <div class="muted" style="margin-top:6px;">
                        手机号：{{ patient.phone }}
                        {% if patient.allergy %}｜ <span style="color:var(--danger); font-weight:900;">过敏史：{{ patient.allergy }}</span>{% endif %}
                        {% if patient.past_illness %}｜ <span style="color:var(--warning); font-weight:900;">既往病史：{{ patient.past_illness }}</span>{% endif %}
                    </div>
                {% endif %}
            </div>
            <a class="btn btn--ghost" href="{{ url_for('doctor.dashboard') }}">返回工作台</a>
        </div>
    </div>

    <div class="grid grid-2">
        <div class="card">
            <div class="page-title">
                <div>
                    <h2>历史挂号/就诊</h2>
                    <div class="subtitle">最近50条</div>
                </div>
            </div>
            <div class="table-wrap">
                <table class="table">
                    <thead><tr><th>时间</th><th>预约日/班次</th><th>排队号</th><th>状态</th><th>医生/科室</th></tr></thead>
                    <tbody>
                    {% for r in regs %}
                        <tr>
                            <td>{{ r.reg_time }}</td>
                            <td>{{ r.visit_date|default('—', true) }} {{ r.shift|default('—', true) }}</td>
                            <td class="mono">{{ r.queue_num }}</td>
                            <td>
                                {% if r.visit_status == '未就诊' %}<span class="badge badge--warning">未就诊</span>
                                {% elif r.visit_status == '就诊中' %}<span class="badge badge--info">就诊中</span>
                                {% elif r.visit_status == '已就诊' %}<span class="badge badge--success">已就诊</span>
                                {% else %}<span class="badge badge--muted">已取消</span>{% endif %}
                            </td>
                            <td>{{ r.doctor_name }} / {{ r.dept_name }}</td>
                        </tr>
                    {% endfor %}
                    {% if not regs %}
                        <tr><td colspan="5" class="muted">暂无历史记录</td></tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="page-title">
                <div>
                    <h2>历史病历</h2>
                    <div class="subtitle">最近50条</div>
                </div>
            </div>
            <div class="table-wrap">
                <table class="table">
                    <thead><tr><th>时间</th><th>医生</th><th>主诉</th><th>诊断</th></tr></thead>
                    <tbody>
                    {% for m in med_records %}
                        <tr>
                            <td>{{ m.create_time }}</td>
                            <td>{{ m.doctor_name }}</td>
                            <td>{{ m.main_complaint }}</td>
                            <td>{{ m.diagnosis }}</td>
                        </tr>
                    {% endfor %}
                    {% if not med_records %}
                        <tr><td colspan="4" class="muted">暂无病历记录</td></tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}
