{% extends "base.html" %}
{% block title %}患者中心 - 诊疗通{% endblock %}

{% block extra_head %}
    <style>
        .doctor-list{display:grid;gap:10px}
        .doctor-item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff}
        .doctor-item:hover{border-color:rgba(47,125,246,.35);box-shadow:0 10px 30px rgba(47,125,246,.08)}
        .doctor-name{font-weight:900}
        .doctor-meta{color:var(--muted);font-size:13px;margin-top:6px}
        .queue{font-weight:900}
    </style>
{% endblock %}

{% block content %}
    <div class="card">
        <div class="page-title">
            <div>
                <h2>欢迎，{{ patient_name }}</h2>
                <div class="subtitle">预约挂号、查看排队与费用</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                <a class="btn btn--ghost" href="{{ url_for('patients.patient_profile') }}">我的档案</a>
                <a class="btn btn--primary" href="{{ url_for('cashier.patient_payments') }}">收银台</a>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="page-title">
            <div>
                <h2>预约挂号</h2>
                <div class="subtitle">选择医生快速挂号（默认当天）</div>
            </div>
        </div>

        <div class="doctor-list">
            {% for doc in doctors %}
                <div class="doctor-item">
                    <div>
                        <div class="doctor-name">{{ doc.name }} <span class="muted">（{{ doc.title }}）</span></div>
                        <div class="doctor-meta">科室：{{ doc.dept_name }} ｜ 挂号费：￥{{ doc.reg_fee }}</div>
                    </div>
                    <a class="btn btn--primary btn--sm"
                       href="{{ url_for('registration.book_appointment', doctor_id=doc.doctor_id) }}"
                       onclick="return confirm('确定要挂 {{ doc.name }} 的号吗？')">立即挂号</a>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="card">
        <div class="page-title">
            <div>
                <h2>我的挂号记录</h2>
                <div class="subtitle">查看状态与支付情况</div>
            </div>
            <a class="btn btn--ghost" href="{{ url_for('cashier.patient_payments') }}">去支付/查看费用</a>
        </div>

        <div class="table-wrap">
            <table class="table">
                <thead>
                <tr>
                    <th>时间</th>
                    <th>预约日/班次</th>
                    <th>医生</th>
                    <th>排队号</th>
                    <th>就诊状态</th>
                    <th>支付状态</th>
                </tr>
                </thead>
                <tbody>
                {% for reg in my_regs %}
                    <tr>
                        <td>{{ reg.reg_time }}</td>
                        <td>{{ reg.visit_date|default('—', true) }} {{ reg.shift|default('—', true) }}</td>
                        <td>{{ reg.doctor_name }}</td>
                        <td class="queue">{{ reg.queue_num }}号</td>
                        <td>
                            {% if reg.visit_status == '未就诊' %}
                                <span class="badge badge--warning">未就诊</span>
                            {% elif reg.visit_status == '就诊中' %}
                                <span class="badge badge--info">就诊中</span>
                            {% elif reg.visit_status == '已就诊' %}
                                <span class="badge badge--success">已就诊</span>
                            {% else %}
                                <span class="badge badge--muted">已取消</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if reg.fee_status == '已支付' %}
                                <span class="badge badge--success">已支付</span>
                            {% else %}
                                <span class="badge badge--warning">未支付</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                {% if not my_regs %}
                    <tr><td colspan="6" class="muted">暂无挂号记录</td></tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
